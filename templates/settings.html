{% extends "base.html" %}

{% block title %}ICM MATH CLICKATHON - Admin{% endblock %}

{% block content %}
<div id="main">
    <div class="container">
        <div id="home" class="flex-center flex-column">
            <h1 class="text-center">Software settings</h1><br><hr>

            <!-- Flash message div -->
            <div>
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="flash {{ category }}">{{ message }}</div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            </div>

            <!-- Manage Schools -->
            <h4>Add New School</h4>
            <form action="/add-school" method="POST">
                <div class="mb-3">
                    <label for="schoolname" class="form-label">School Name</label>
                    <input type="text" class="form-control" id="schoolname" name="schoolname" placeholder="Enter school name" required>
                </div>
                <div class="mb-3">
                    <label for="groupcount" class="form-label">Number of Groups</label>
                    <input type="number" class="form-control" id="groupcount" name="groupcount" placeholder="Enter number of groups" required min="1">
                </div>
                <div class="mb-3">
                    <label for="season" class="form-label">Quiz Season</label>
                    <input type="number" class="form-control" id="season" name="season" placeholder="Enter the season" required min="1">
                </div>
                <button type="submit" class="btn btn-primary">Add School and Groups</button>
            </form>
            <br><br><hr>
            <h4>Enable/Disable Registration</h4>
            <form action="{{ url_for('toggle_registration') }}" method="POST">
                <button type="submit" class="btn btn-primary">
                    {% if allow_registration %}
                    Disable Registration (Registration is on)
                    {% else %}
                    Enable Registration (Registration is off)
                    {% endif %}
                </button>
            </form>
            <br><br><hr>
            <h4>Enable/Disable Quiz</h4>
            <form action="{{ url_for('toggle_quiz') }}" method="POST">
                <button type="submit" class="btn btn-primary">
                    {% if allow_quiz %}
                    Disable Quiz (Quiz is Enabled)
                    {% else %}
                    Enable Quiz (Quiz is disabled)
                    {% endif %}
                </button>
            </form>
            <br><br><hr>
            
            <!-- Quiz Configuration -->
            <h4>Set Current Quiz Configuration</h4>
            <form action="{{ url_for('set_quiz_config') }}" method="POST">
                <div class="mb-3">
                    <label for="current_season" class="form-label">Current Season</label>
                    <input type="number" class="form-control" id="current_season" name="current_season" 
                        value="{{ current_season }}" min="1" required>
                </div>
                <div class="mb-3">
                    <label for="current_subject" class="form-label">Current Subject</label>
                    <select class="form-select" id="current_subject" name="current_subject" required>
                        <option value="" disabled>Select Subject</option>
                        <option value="math" {% if current_subject == 'math' %}selected{% endif %}>Mathematics</option>
                        <option value="science" {% if current_subject == 'science' %}selected{% endif %}>Science</option>
                        <option value="english" {% if current_subject == 'english' %}selected{% endif %}>English</option>
                        <option value="general" {% if current_subject == 'general' %}selected{% endif %}>General Knowledge</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="question_count" class="form-label">Number of Questions</label>
                    <input type="number" class="form-control" id="question_count" name="question_count" 
                        value="{{ question_count }}" min="1" max="100" required>
                </div>
                <div class="mb-3">
                    <label for="quiz_duration" class="form-label">Quiz Duration (seconds)</label>
                    <input type="number" class="form-control" id="quiz_duration" name="quiz_duration" 
                        value="{{ quiz_duration }}" min="1" required>
                </div>
                <button type="submit" class="btn btn-primary">Save Configuration</button>
            </form>
            
            <br><br><hr>

            <h4>Manage students</h4>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>S/N</th>  <!-- Serial Number Column -->
                        <th>Student Name</th>
                        <th>School Name</th>
                        <th>Group name</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ user.fullname | title }}</td>
                        <td>{{ user.school_name }}</td>
                        <td>{{ user.group_name }}</td>
                        <td>
                            <form action="{{ url_for('delete_user', user_id=user.id)}}" method="post" onsubmit="return confirm('Are you sure you want to delete this student?');">
                                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    window.onload = function() {
        setTimeout(function() {
            var flashes = document.getElementsByClassName('flash');
            for (var i = 0; i < flashes.length; i++) {
                flashes[i].style.opacity = '0';
                setTimeout(function(flash) {
                    flash.style.display = 'none';
                }, 500, flashes[i]); // Adjust the time to match the transition duration
            }
        }, 3000); // Adjust the duration the flash message should be visible (in milliseconds)
    };
</script>
{% endblock %}

{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h4><i class="lni lni-download"></i> Confirm Data Download</h4>
        </div>
        <div class="card-body">
            <p>The following data will be downloaded from the online system:</p>
            
            <div class="mb-4">
                {% for table, data in preview_data.items() %}
                <div class="card mb-3">
                    <div class="card-header">
                        <strong>{{ table|title }}</strong> ({{ data.count }} records)
                    </div>
                    <div class="card-body">
                        {% if data.sample %}
                            <div class="table-responsive">
                                <table class="table table-sm table-hover">
                                    <thead>
                                        <tr>
                                            {% for key in data.sample[0].keys() %}
                                            <th>{{ key }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in data.sample %}
                                        <tr>
                                            {% for value in row.values() %}
                                            <td>{{ value }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% if data.count > 3 %}
                            <p class="text-muted">+ {{ data.count - 3 }} more records...</p>
                            {% endif %}
                        {% else %}
                            <p class="text-muted">No records found</p>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <div class="alert alert-warning">
                <i class="lni lni-warning"></i> This will overwrite existing data in your local database.
            </div>
            
            <form method="POST" action="{{ url_for('process_download') }}">
                <button type="submit" class="btn btn-primary">
                    <i class="lni lni-download"></i> Confirm Download
                </button>
                <a href="{{ url_for('admin_panel') }}" class="btn btn-secondary">
                    <i class="lni lni-close"></i> Cancel
                </a>
            </form>
        </div>
    </div>
</div>
{% endblock %}